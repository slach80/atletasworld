<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule - Coach Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { primary: '#1a1a1a', secondary: '#2ecc71', accent: '#e74c3c' } } }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-primary text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/"><img src="/media/APC-logo.jpg" alt="Atletas World" class="h-10 w-auto rounded"></a>
                    <span class="ml-4 text-lg font-semibold">Coach Portal</span>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="{% url 'coaches:dashboard' %}" class="hover:text-secondary transition">Dashboard</a>
                    <a href="{% url 'coaches:schedule' %}" class="text-secondary font-semibold">Schedule</a>
                    <a href="{% url 'coaches:my_players' %}" class="hover:text-secondary transition">My Players</a>
                    <a href="{% url 'coaches:assessments' %}" class="hover:text-secondary transition">Assessments</a>
                    <a href="/accounts/logout/" class="text-gray-400 hover:text-accent">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-6">
        <!-- Header with navigation -->
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">Schedule Management</h1>
            <div class="flex space-x-2">
                <a href="{% url 'coaches:add_bulk_schedule' %}" class="bg-secondary text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                    + Add Availability
                </a>
            </div>
        </div>

        <!-- Week Navigation -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-6">
            <div class="flex justify-between items-center">
                <a href="?start={{ prev_week }}" class="px-4 py-2 border rounded-lg hover:bg-gray-50">&larr; Previous Week</a>
                <h2 class="text-lg font-semibold">{{ start_date|date:"M j" }} - {{ end_date|date:"M j, Y" }}</h2>
                <a href="?start={{ next_week }}" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Next Week &rarr;</a>
            </div>
        </div>

        <!-- Week Calendar -->
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="grid grid-cols-7 gap-4">
                {% for day in week_days %}
                <div class="border rounded-lg p-3 min-h-[200px] {% if day.date == today %}bg-secondary/5 border-secondary{% endif %}">
                    <div class="text-center mb-3 pb-2 border-b">
                        <p class="text-sm text-gray-500">{{ day.day_name }}</p>
                        <p class="font-bold {% if day.date == today %}text-secondary{% endif %}">{{ day.date|date:"j" }}</p>
                    </div>
                    <div class="space-y-2">
                        {% for block in day.blocks %}
                        <div class="p-2 rounded text-xs {% if block.status == 'booked' %}bg-blue-100 border-blue-300{% elif block.status == 'available' %}bg-green-100 border-green-300{% else %}bg-gray-100{% endif %} border">
                            <p class="font-semibold">{{ block.start_time|time:"g:i A" }}</p>
                            <p class="text-gray-600">{{ block.get_session_type_display|truncatechars:10 }}</p>
                            <p class="text-gray-500">{{ block.current_participants }}/{{ block.max_participants }}</p>
                            {% if block.current_participants == 0 %}
                            <form method="POST" action="{% url 'coaches:delete_schedule_block' block.id %}" class="mt-1">
                                {% csrf_token %}
                                <button type="submit" class="text-red-500 hover:text-red-700 text-xs">Delete</button>
                            </form>
                            {% endif %}
                        </div>
                        {% empty %}
                        <p class="text-gray-400 text-xs text-center">No slots</p>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Legend -->
        <div class="mt-4 flex justify-center space-x-6 text-sm">
            <div class="flex items-center"><span class="w-4 h-4 bg-green-100 border border-green-300 rounded mr-2"></span> Available</div>
            <div class="flex items-center"><span class="w-4 h-4 bg-blue-100 border border-blue-300 rounded mr-2"></span> Booked</div>
        </div>

        <!-- Quick Add Form -->
        <div class="bg-white rounded-xl shadow-md p-6 mt-6">
            <h3 class="text-lg font-bold mb-4">Quick Add Single Slot</h3>
            <form method="POST" action="{% url 'coaches:add_schedule_block' %}" class="grid grid-cols-2 md:grid-cols-5 gap-4">
                {% csrf_token %}
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Date</label>
                    <input type="date" name="date" required class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Start Time</label>
                    <input type="time" name="start_time" required class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Session Type</label>
                    <select name="session_type" class="w-full px-3 py-2 border rounded-lg">
                        {% for value, label in session_types %}
                        <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Duration</label>
                    <select name="duration" class="w-full px-3 py-2 border rounded-lg">
                        {% for value, label in duration_choices %}
                        <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex items-end">
                    <button type="submit" class="w-full bg-secondary text-white px-4 py-2 rounded-lg hover:bg-green-600">Add Slot</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
